/* 
 * Custom jQuery and js for ezIGBT Graph drawing
 */

jQuery(document).ready(function(){jQuery(".onchange_ajax > select").each(function(b,c){jQuery(c).on("change",function(){jQuery(this).parents(".controls-wrapper").find("a.plot-graph-button").trigger("click")})});jQuery('.analyze .controls-wrapper input[type="text"]').on("change",function(){var b=jQuery(this).parents(".controls-wrapper").find(".select_model > select").val();if(b){var d=validate_value(this);var c=check_ajax_req_cond(this);if(d===true){if(c){jQuery(this).parents(".controls-wrapper").find(".plot-graph-button").trigger("click")}}else{alert(d)}}else{jQuery("#graph-msg").html("Please Choose an IGBT").fadeIn()}});previousPoint=null;var a=new Array("#tab1-graph1","#tab1-graph2","#tab2-graph1");a.forEach(function(b){jQuery(b).bind("plothover",function(e,h,d){if(d){if(previousPoint!=d.datapoint){previousPoint=d.datapoint;jQuery("#tooltip").remove();var c=d.datapoint[0].toFixed(2),g=d.datapoint[1].toFixed(2),f="X="+c+", Y="+g;showGraphTooltip(d.pageX,d.pageY,f)}}else{jQuery("#tooltip").remove();previousPoint=null}})});jQuery(".analyze .tab1 a.plot-graph-button").click(function(j){j.preventDefault();fill_default_values(jQuery(".analyze .tab1 .controls-wrapper"));var h=jQuery(this).parents(".controls-wrapper");var b=jQuery(this).data("graph-id");var g=jQuery(h).find('select[name="tab1_chosemodel"]').val();var f=jQuery(h).find('input[name="mytj"]').val();var i=jQuery(h).find('input[name="imin"]').val();var c=jQuery(h).find('input[name="imax"]').val();if((b!==undefined)&&(graph_ajaxurl!==undefined)){var d={action:b,modal_id:g,mytj:f,imin:i,imax:c};jQuery("#ez-ajax-loader").show();jQuery("#graph-msg").fadeOut();jQuery.ajax({type:"POST",url:graph_ajaxurl,dataType:"json",data:d,success:function(k){if(k.error===false){var p={data:"",color:"#74C3E4",label:"at My T<sub>j<sub>"};var o={data:"",color:"#439123",label:"at 25C"};var n={data:"",color:"#DA251D",label:"at T<sub>jMAX<sub>"};var r={lines:{show:true},points:{show:true},legend:{position:"nw"},grid:{hoverable:true}};if(k.data[0]){var m=k.data[0];p.data=m[0];o.data=m[1];n.data=m[2];var l=[p,o,n];jQuery.plot(jQuery("#tab1-graph1"),l,r)}if(k.data[1]){var q=k.data[1];p.data=q[0];o.data=q[1];n.data=q[2];var e=[p,o,n];jQuery.plot(jQuery("#tab1-graph2"),e,r)}}else{jQuery.plot(jQuery("#tab1-graph1"),"");jQuery.plot(jQuery("#tab1-graph2"),"");jQuery("#graph-msg").html(k.error_msg).fadeIn()}},error:function(e,k){jQuery.plot(jQuery("#tab1-graph1"),"");jQuery.plot(jQuery("#tab1-graph2"),"");jQuery("#graph-msg").html(k).fadeIn();jQuery("#ez-ajax-loader").hide()}}).done(function(){jQuery("#ez-ajax-loader").hide()})}});jQuery(".analyze .tab2 .plot-graph-button").on("click",function(j){j.preventDefault();fill_default_values(jQuery(".analyze .tab2 .controls-wrapper"));var d=jQuery(this).data("graph-id");var h=jQuery(".tab2 select").val();var m=jQuery(this).parents(".controls-wrapper");var l=jQuery(m).find('input[name="tab2_ip1"]').val();var f=jQuery(m).find('input[name="tab2_ip2"]').val();var i=jQuery(m).find('input[name="tab2_ip3"]').val();var b=jQuery(m).find('input[name="tab2_ip4"]').val();var k=jQuery(m).find('input[name="tab2_ip5"]').val();var c=jQuery(m).find('input[name="tab2_ip6"]').val();if((d!==undefined)&&(graph_ajaxurl!==undefined)){var g={action:d,model_name:h,mytj:l,myd:f,myvdc:i,myi:b,fmin:k,fmax:c};jQuery("#ez-ajax-loader").show();jQuery("#graph-msg").fadeOut();jQuery.ajax({type:"POST",url:graph_ajaxurl,dataType:"json",data:g,success:function(e){console.log(e);jQuery("#ez-ajax-loader").hide();jQuery("#graph-msg").fadeOut();if(e.error===false){var o={data:e.data,color:"#439123",label:" at "+l+"C"};var n={lines:{show:true},points:{show:true},legend:{position:"nw"},grid:{hoverable:true}};jQuery.plot(jQuery("#tab2-graph1"),[o],n)}else{jQuery.plot(jQuery("#tab2-graph1"),"");jQuery("#graph-msg").html(e.error_msg).fadeIn()}},error:function(e,n){console.log(e);jQuery.plot(jQuery("#tab2-graph1"),"");jQuery("#graph-msg").html(n).fadeIn();jQuery("#ez-ajax-loader").hide()}})}});jQuery(".compare .tab1 a.plot-graph-button").click(function(h){h.preventDefault();var j=jQuery(this).parents(".controls-wrapper");var d=jQuery(this).data("graph-id");var c=jQuery(".zzzz select").val();var b=jQuery(j).find('select[name="tab1_chosemode2"]').val();var k=jQuery(j).find('select[name="tab1_chosemode3"]').val();var i=jQuery(j).find('input[name="mytj"]').val();var l=jQuery(j).find('input[name="imin"]').val();var f=jQuery(j).find('input[name="imax"]').val();if((d!==undefined)&&(graph_ajaxurl!==undefined)){var g={action:"compare_tab1",modal_id1:c,modal_id2:b,modal_id3:k,mytj:i,imin:l,imax:f};jQuery("#ez-ajax-loader").show();jQuery("#graph-msg").fadeOut();jQuery.ajax({type:"POST",url:graph_ajaxurl,dataType:"json",data:g,success:function(m){console.log(m);if(m.error===false){var q={data:"",color:"#74C3E4",label:"Model #1"};var p={data:"",color:"#439123",label:"Model #2"};var o={data:"",color:"#8B4789",label:"Model #3"};var t={lines:{show:true},points:{show:true},legend:{position:"nw"},grid:{hoverable:true}};if(m.data[0]){var n=m.data[0];q.data=n[0];p.data=n[1];o.data=n[2];var e=[q,p,o];jQuery.plot(jQuery("#tab1-graph1"),e,t)}if(m.data[1]){var r=m.data[1];q.data=r[0];p.data=r[1];o.data=r[2];var s=[q,p,o];jQuery.plot(jQuery("#tab1-graph2"),s,t)}}else{jQuery("#graph-msg").html(m.error_msg).fadeIn();jQuery.plot(jQuery("#tab1-graph1"),"");jQuery.plot(jQuery("#tab1-graph2"),"")}},error:function(e,m){console.log(e);jQuery.plot(jQuery("#tab1-graph1"),"");jQuery.plot(jQuery("#tab1-graph2"),"");jQuery("#graph-msg").html(m).fadeIn();jQuery("#ez-ajax-loader").hide()}}).done(function(){jQuery("#ez-ajax-loader").hide()})}});jQuery(".compare .tab2 a.plot-graph-button").on("click",function(k){k.preventDefault();var n=jQuery(this).parents(".controls-wrapper");var g=jQuery(this).data("graph-id");var d=jQuery('select[name="tab2_chosemodel"]').val();var b=jQuery(n).find('select[name="tab2_chosemode2"]').val();var o=jQuery(n).find('select[name="tab2_chosemode3"]').val();var c=jQuery(n).find('tab2-myi input[name="myi"]').val();var m=jQuery(n).find('.tab2-mytj input[name="mytj"]').val();var h=jQuery(n).find('.tab2-myd input[name="myd"]').val();var j=jQuery(n).find('.tab2-myvdc input[name="myvdc"]').val();var l=jQuery(n).find('.tab2-fmin input[name="fmin"]').val();var f=jQuery(n).find('.tab2-fmax input[name="fmax"]').val();if((g!==undefined)&&(graph_ajaxurl!==undefined)){var i={action:"compare_tab2",modal_id1:d,modal_id2:b,modal_id3:o,mytj:m,myd:h,myi:c,myvdc:j,fmin:l,fmax:f};jQuery("#ez-ajax-loader").show();jQuery("#graph-msg").fadeOut();jQuery.ajax({type:"POST",url:graph_ajaxurl,dataType:"json",data:i,success:function(e){console.log(e);if(e.error===false){var u={data:"",color:"#74C3E4",label:"Model #1"};var t={data:"",color:"#439123",label:"Model #2"};var r={data:"",color:"#8B4789",label:"Model #3"};var p={lines:{show:true},points:{show:true},legend:{position:"nw"},grid:{hoverable:true}};if(e.data){var q=e.data;u.data=q[0];t.data=q[1];r.data=q[2];var s=[u,t,r];jQuery.plot(jQuery("#tab2-graph1"),s,p)}}else{jQuery("#graph-msg").html(e.error_msg).fadeIn();jQuery.plot(jQuery("#tab2-graph1"),"")}},error:function(e,p){console.log(e);jQuery.plot(jQuery("#tab2-graph1"),"");jQuery("#graph-msg").html(p).fadeIn();jQuery("#ez-ajax-loader").hide()}}).done(function(){jQuery("#ez-ajax-loader").hide()})}})});function showGraphTooltip(a,c,b){jQuery('<div id="tooltip">'+b+"</div>").css({top:c+15,left:a+5}).appendTo("body").fadeIn(200)}function fill_default_values(a){if(a.length>0){jQuery(a).find('input[type="text"]').each(function(d,e){var c=jQuery(this).val();var b=jQuery(this).data("default");if(!c&&b){jQuery(this).prev("label").hide();jQuery(this).val(b)}})}}function validate_value(a){var b=jQuery(a).val();var c=jQuery(a).parent("span");if(jQuery(c).hasClass("round")){if(jQuery.trim(b)!==""){if(isNaN(parseInt(b))){return"Please enter an integer value"}else{b=Math.round(b);jQuery(a).val(b)}}}if(jQuery(c).hasClass("intonly")){if(jQuery.trim(b)!==""){if(isNaN(parseInt(b))){return"Please enter an integer value"}}}return true}function check_ajax_req_cond(d){if(jQuery(d).parent("span").hasClass("cond-iminimax")){var e=jQuery(d).parents(".controls-wrapper").find(".cond-iminimax");for(var c=1;c<=e.length;c++){var b=e[c-1];var a=jQuery(b).children('input[type="text"]').val();if(a===""){return false}}}return true};